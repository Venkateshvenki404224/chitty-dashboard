{% extends "base.html" %}
{% block page_title %}üìÅ Documents{% endblock %}

{% block extra_css %}
<style>
    .doc-row { cursor: pointer; transition: background 0.15s; }
    .doc-row:hover { background: #f0f4ff !important; }
    .doc-row.active { background: #e8edff !important; }
    .doc-viewer { max-height: 700px; overflow-y: auto; }
    .doc-viewer pre { background: #f5f5f5; padding: 16px; border-radius: 6px; overflow-x: auto; font-size: 0.85rem; }
    .doc-viewer table { width: 100%; border-collapse: collapse; }
    .doc-viewer table th, .doc-viewer table td { padding: 6px 10px; border: 1px solid #ddd; }
    .type-badge { font-size: 0.7rem; padding: 2px 6px; }
    .search-box { position: relative; }
    .search-box i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; font-size: 18px; }
    .search-box input { padding-left: 38px; }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <!-- File List -->
    <div class="col-lg-{% if doc_content %}5{% else %}12{% endif %}">
        <div class="card">
            <div class="card-header bg-white">
                <div class="d-flex align-items-center mb-2">
                    <h4 class="card-header__title flex m-0">Files</h4>
                    <span class="text-muted">{{ docs|length }} files</span>
                </div>
                <div class="search-box">
                    <i class="material-icons">search</i>
                    <input type="text" class="form-control" id="doc-search" placeholder="Search files by name...">
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive" style="max-height: 600px; overflow-y: auto;">
                    <table class="table table-hover mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th>Name</th>
                                <th>Type</th>
                                <th>Size</th>
                                <th>Modified</th>
                                <th>Source</th>
                            </tr>
                        </thead>
                        <tbody id="doc-table-body">
                            {% for doc in docs %}
                            <tr class="doc-row {% if doc_content and doc_content.path == doc.path %}active{% endif %}" onclick="window.location='/docs?file={{ doc.path|urlencode }}'">
                                <td>
                                    <i class="material-icons icon-16pt mr-1 text-muted">
                                        {% if doc.type == '.md' %}description{% elif doc.type == '.json' %}code{% elif doc.type == '.log' %}receipt{% else %}insert_drive_file{% endif %}
                                    </i>
                                    <strong>{{ doc.name }}</strong>
                                </td>
                                <td>
                                    <span class="badge type-badge {% if doc.type == '.md' %}badge-primary{% elif doc.type == '.json' %}badge-warning{% elif doc.type == '.log' %}badge-info{% else %}badge-secondary{% endif %}">
                                        {{ doc.type or 'file' }}
                                    </span>
                                </td>
                                <td class="text-muted">{{ doc.size }}</td>
                                <td class="text-muted">{{ doc.modified }}</td>
                                <td><small class="text-muted">{{ doc.label }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    {% if doc_content %}
    <!-- Document Viewer -->
    <div class="col-lg-7">
        <div class="card">
            <div class="card-header bg-white d-flex align-items-center">
                <h4 class="card-header__title flex m-0">
                    <i class="material-icons icon-16pt mr-1">visibility</i>
                    {{ doc_content.name }}
                </h4>
                <a href="/docs" class="btn btn-sm btn-outline-secondary">
                    <i class="material-icons icon-16pt">close</i> Close
                </a>
            </div>
            <div class="card-body doc-viewer">
                {% if doc_content.html %}
                    {{ doc_content.html|safe }}
                {% else %}
                    <pre>{{ doc_content.content }}</pre>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Client-side search filter
    document.getElementById('doc-search').addEventListener('input', function() {
        var query = this.value.toLowerCase();
        var rows = document.querySelectorAll('#doc-table-body .doc-row');
        rows.forEach(function(row) {
            var name = row.querySelector('strong').textContent.toLowerCase();
            row.style.display = name.includes(query) ? '' : 'none';
        });
    });
</script>
{% endblock %}
