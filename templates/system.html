{% extends "base.html" %}
{% block page_title %}System Info{% endblock %}

{% block content %}
<div class="row card-group-row mb-4">
    <div class="col-lg-3 col-md-6 card-group-row__col">
        <div class="card card-group-row__card">
            <div class="card-body text-center">
                <i class="material-icons text-primary mb-2" style="font-size: 36px;">memory</i>
                <div class="card-header__title">CPU Usage</div>
                <div style="font-size: 2rem; font-weight: 700;" id="sys-cpu">{{ sys_info.cpu.percent }}%</div>
                <small class="text-muted">{{ sys_info.cpu.cores }} cores @ {{ sys_info.cpu.freq }} MHz</small>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 card-group-row__col">
        <div class="card card-group-row__card">
            <div class="card-body text-center">
                <i class="material-icons text-warning mb-2" style="font-size: 36px;">storage</i>
                <div class="card-header__title">Memory</div>
                <div style="font-size: 2rem; font-weight: 700;" id="sys-mem">{{ sys_info.memory.percent }}%</div>
                <small class="text-muted">{{ sys_info.memory.used }} / {{ sys_info.memory.total }}</small>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 card-group-row__col">
        <div class="card card-group-row__card">
            <div class="card-body text-center">
                <i class="material-icons text-success mb-2" style="font-size: 36px;">sd_storage</i>
                <div class="card-header__title">Disk</div>
                <div style="font-size: 2rem; font-weight: 700;" id="sys-disk">{{ sys_info.disk.percent }}%</div>
                <small class="text-muted">{{ sys_info.disk.used }} / {{ sys_info.disk.total }}</small>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6 card-group-row__col">
        <div class="card card-group-row__card">
            <div class="card-body text-center">
                <i class="material-icons text-info mb-2" style="font-size: 36px;">schedule</i>
                <div class="card-header__title">Uptime</div>
                <div style="font-size: 1.5rem; font-weight: 700;">{{ sys_info.uptime }}</div>
                <small class="text-muted">Since {{ sys_info.boot_time }}</small>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-white">
                <h4 class="card-header__title m-0">Server Info</h4>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped mb-0">
                    <tbody>
                        <tr><td class="font-weight-bold">Hostname</td><td>{{ sys_info.hostname }}</td></tr>
                        <tr><td class="font-weight-bold">OS</td><td>{{ sys_info.os }}</td></tr>
                        <tr><td class="font-weight-bold">Architecture</td><td>{{ sys_info.arch }}</td></tr>
                        <tr><td class="font-weight-bold">Python</td><td>{{ sys_info.python }}</td></tr>
                        <tr><td class="font-weight-bold">CPU Cores</td><td>{{ sys_info.cpu.cores }}</td></tr>
                        <tr><td class="font-weight-bold">CPU Freq</td><td>{{ sys_info.cpu.freq }} MHz</td></tr>
                        <tr><td class="font-weight-bold">Total RAM</td><td>{{ sys_info.memory.total }}</td></tr>
                        <tr><td class="font-weight-bold">Available RAM</td><td>{{ sys_info.memory.available }}</td></tr>
                        <tr><td class="font-weight-bold">Total Disk</td><td>{{ sys_info.disk.total }}</td></tr>
                        <tr><td class="font-weight-bold">Free Disk</td><td>{{ sys_info.disk.free }}</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-header bg-white">
                <h4 class="card-header__title m-0">Services</h4>
            </div>
            <div class="card-body">
                {% for svc in services %}
                <div class="d-flex align-items-center mb-3">
                    <i class="material-icons mr-2 {{ 'text-success' if svc.status == 'running' else 'text-danger' if svc.status == 'stopped' else 'text-muted' }}" style="font-size: 28px;">{{ svc.icon }}</i>
                    <div class="flex">
                        <div class="font-weight-bold">{{ svc.name }}</div>
                    </div>
                    <span class="badge badge-{{ 'success' if svc.status == 'running' else 'danger' if svc.status == 'stopped' else 'secondary' }}">
                        {{ svc.status }}
                    </span>
                </div>
                {% endfor %}
                {% if not services %}
                <div class="text-center text-muted py-3">No services detected</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function refreshSystem() {
    fetch('/api/system')
        .then(r => r.json())
        .then(data => {
            document.getElementById('sys-cpu').textContent = data.system.cpu.percent + '%';
            document.getElementById('sys-mem').textContent = data.system.memory.percent + '%';
            document.getElementById('sys-disk').textContent = data.system.disk.percent + '%';
        });
}
setInterval(refreshSystem, 30000);
</script>
{% endblock %}
